"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7714],{99747:function(e,l,n){n.r(l);let a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatSubscriptionPaywallContextWrapper_bot",selections:[{alias:null,args:null,kind:"ScalarField",name:"botId",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"limitedAccessType",storageKey:null},{alias:null,args:null,concreteType:"MessageLimit",kind:"LinkedField",name:"messageLimit",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"canSend",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shouldShowSubscriptionRationale",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dailyLimit",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"MessageLimit",kind:"LinkedField",name:"messageUsageLimit",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"shouldPromptSubscription",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shouldShowLimitInfoBanner",storageKey:null}],storageKey:null},{args:null,kind:"FragmentSpread",name:"WebSubscriptionAnnouncementModalOpener_bot"},{args:null,kind:"FragmentSpread",name:"WebSpeedUpsellModalOpener_bot"},{args:null,kind:"FragmentSpread",name:"subscriptionHelpers_useBotLogData_bot"}],type:"Bot",abstractKey:null};a.hash="bcc8730ac19995cc0e69307b9e023c3b",l.default=a},35363:function(e,l,n){n.r(l);let a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatSubscriptionPaywallContextWrapper_usePaywallAndLog_bot",selections:[{args:null,kind:"FragmentSpread",name:"subscriptionHelpers_useBotLogData_bot"}],type:"Bot",abstractKey:null};a.hash="e86dcb63108845be4baba940f82cfaa4",l.default=a},47252:function(e,l,n){n.r(l);let a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatSubscriptionPaywallContextWrapper_viewer",selections:[{alias:null,args:null,concreteType:"PoeUser",kind:"LinkedField",name:"poeUser",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Subscription",kind:"LinkedField",name:"subscription",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"isActive",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isEligibleForWebSubscriptions",storageKey:null},{alias:"useNewLimitSystem",args:[{kind:"Literal",name:"gateName",value:"poe_use_new_limit_system_frontend"}],kind:"ScalarField",name:"booleanGate",storageKey:'booleanGate(gateName:"poe_use_new_limit_system_frontend")'},{args:null,kind:"FragmentSpread",name:"WebSubscriptionAnnouncementModalOpener_viewer"},{args:null,kind:"FragmentSpread",name:"WebSpeedUpsellModalOpener_viewer"},{args:null,kind:"FragmentSpread",name:"WebSubscriptionSuccessMessage_useWebSubscriptionSuccessMessage_viewer"}],type:"Viewer",abstractKey:null};a.hash="4e9babdc83c284e610ef86ed664e7282",l.default=a},66856:function(e,l,n){n.r(l);let a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"WebSpeedUpsellModalOpener_bot",selections:[{alias:null,args:null,kind:"ScalarField",name:"botId",storageKey:null}],type:"Bot",abstractKey:null};a.hash="7ade3cf445794d7a100c58c2d220fbc4",l.default=a},68222:function(e,l,n){var a,i,s;n.r(l);let t={fragment:{argumentDefinitions:a=[{defaultValue:null,kind:"LocalArgument",name:"dismissibleType"}],kind:"Fragment",metadata:null,name:"WebSpeedUpsellModalOpener_dismissDismissible_Mutation",selections:[{alias:null,args:i=[{kind:"Variable",name:"dismissibleType",variableName:"dismissibleType"}],concreteType:"DismissDismissible",kind:"LinkedField",name:"dismissDismissible",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[s={alias:null,args:null,kind:"ScalarField",name:"shouldSeeResponseSpeedUpsell",storageKey:null}],storageKey:null}],storageKey:null}],type:"MutationRoot",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WebSpeedUpsellModalOpener_dismissDismissible_Mutation",selections:[{alias:null,args:i,concreteType:"DismissDismissible",kind:"LinkedField",name:"dismissDismissible",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[s,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:"97465bf0683cf08e943fd041b1d8c29bbd87090b96af6094ddeea6b0ccb20230",metadata:{},name:"WebSpeedUpsellModalOpener_dismissDismissible_Mutation",operationKind:"mutation",text:null}};t.hash="2f0221b1e1202952d33cc565324d9d37",l.default=t},22234:function(e,l,n){n.r(l);let a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"WebSpeedUpsellModalOpener_viewer",selections:[{alias:null,args:null,concreteType:"Subscription",kind:"LinkedField",name:"subscription",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"isActive",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shouldSeeResponseSpeedUpsell",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shouldSeeWebSubscriptionAnnouncement",storageKey:null}],type:"Viewer",abstractKey:null};a.hash="8ff847cd3db3d848f7361368c197c090",l.default=a},60867:function(e,l,n){n.r(l);let a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"WebSubscriptionAnnouncementModalOpener_bot",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"isSystemBot",storageKey:null}],type:"Bot",abstractKey:null};a.hash="96e05b9ab8f921f956986a29ebe861f3",l.default=a},60943:function(e,l,n){var a,i,s;n.r(l);let t={fragment:{argumentDefinitions:a=[{defaultValue:null,kind:"LocalArgument",name:"dismissibleType"}],kind:"Fragment",metadata:null,name:"WebSubscriptionAnnouncementModalOpener_dismissDismissible_Mutation",selections:[{alias:null,args:i=[{kind:"Variable",name:"dismissibleType",variableName:"dismissibleType"}],concreteType:"DismissDismissible",kind:"LinkedField",name:"dismissDismissible",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[s={alias:null,args:null,kind:"ScalarField",name:"shouldSeeWebSubscriptionAnnouncement",storageKey:null}],storageKey:null}],storageKey:null}],type:"MutationRoot",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WebSubscriptionAnnouncementModalOpener_dismissDismissible_Mutation",selections:[{alias:null,args:i,concreteType:"DismissDismissible",kind:"LinkedField",name:"dismissDismissible",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[s,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:"4a5844dcd7e79cd6b2c0bcadebbbf593e85a167b1cab854d5527e6be12c8b468",metadata:{},name:"WebSubscriptionAnnouncementModalOpener_dismissDismissible_Mutation",operationKind:"mutation",text:null}};t.hash="5ef690b09af14848d43e2c77b76aeaad",l.default=t},99343:function(e,l,n){n.r(l);let a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"WebSubscriptionAnnouncementModalOpener_viewer",selections:[{alias:null,args:null,concreteType:"Subscription",kind:"LinkedField",name:"subscription",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"isActive",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shouldSeeWebSubscriptionAnnouncement",storageKey:null},{alias:null,args:null,concreteType:"PoeUser",kind:"LinkedField",name:"poeUser",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"creationTime",storageKey:null}],storageKey:null}],type:"Viewer",abstractKey:null};a.hash="2f5b19f143369a7a724a2c3712f4c1b4",l.default=a},78739:function(e,l,n){n.d(l,{ZP:function(){return M},rk:function(){return K},Sz:function(){return v}});var a=n(85893),i=n(67294),s=n(22578),t=n(81534);n(44311);var r=n(41019),u=n(71289),o=n(28775);let d=[3002,3004],m=()=>n.e(5953).then(n.bind(n,25953));var c=e=>{var l;let{bot:t,viewer:c}=e,b=(0,s.useFragment)(n(66856),t),p=(0,s.useFragment)(n(22234),c),[g]=(0,s.useMutation)(n(68222)),y=(0,i.useContext)(u.cq),S=!y.isEmbed&&d.includes(b.botId)&&p.shouldSeeResponseSpeedUpsell&&!p.shouldSeeWebSubscriptionAnnouncement&&!(null===(l=p.subscription)||void 0===l?void 0:l.isActive),[k,f]=(0,i.useState)(S),F=(0,i.useCallback)(()=>{f(!1),g({variables:{dismissibleType:o.Z.response_speed_upsell},onCompleted:()=>{f(!1)}})},[f,g]),h=(0,i.useMemo)(()=>({viewer:p,closeAnnouncement:F}),[p,F]);return(0,a.jsx)(r.Z,{isOpen:k,onRequestClose:F,body:m,bodyProps:h,useMinHeight:!0})},b=n(41143),p=n.n(b);let g=()=>n.e(2334).then(n.bind(n,92334));var y=e=>{var l,t;let{bot:d,viewer:m}=e,c=(0,s.useFragment)(n(60867),d),b=(0,s.useFragment)(n(99343),m),[y]=(0,s.useMutation)(n(60943)),S=null===(l=b.poeUser)||void 0===l?void 0:l.creationTime;p()(!!S,"Viewer creation time cannot be empty!");let k=S/1e3,f=Date.now()-k>=864e5,F=(0,i.useContext)(u.cq),h=!F.isEmbed&&b.shouldSeeWebSubscriptionAnnouncement&&!(null===(t=b.subscription)||void 0===t?void 0:t.isActive)&&c.isSystemBot&&f,[_,K]=(0,i.useState)(h),v=(0,i.useCallback)(()=>{K(!1),y({variables:{dismissibleType:o.Z.web_subs_announcement},onCompleted:()=>{K(!1)}})},[K,y]),w=(0,i.useMemo)(()=>({closeAnnouncement:v}),[v]);return(0,a.jsx)(r.Z,{isOpen:_,onRequestClose:v,body:g,bodyProps:w,modalHeight:200,useMinHeight:!0})},S=n(75408),k=n(18974),f=n(77614),F=n(96676),h=n(47128);let _={shouldPromptSubscription:!1,shouldShowRateLimitedBanner:!1,setPaywallVisible:()=>{}},K=()=>{let{shouldPromptSubscription:e,shouldShowRateLimitedBanner:l,setPaywallVisible:n}=i.useContext(L),a=(0,i.useCallback)(()=>{n(!1)},[n]),s=(0,i.useCallback)(()=>{n(!0)},[n]);return{shouldPromptSubscription:e,shouldShowRateLimitedBanner:l,openPaywall:s,closePaywall:a}},v=e=>{let{bot:l}=e,a=(0,s.useFragment)(n(35363),l),{openPaywall:r,shouldPromptSubscription:u}=K(),{logClick:o}=(0,t.B)(a),d=(0,i.useCallback)(()=>{o(f.Z.limited_access_bot),r()},[o,r]);return{shouldPromptSubscription:u,openPaywallAndLog:d}},w=()=>Promise.all([n.e(7846),n.e(576),n.e(4247)]).then(n.bind(n,26261)),L=i.createContext(_);var M=e=>{var l;let{bot:t,viewer:r,children:u}=e,o=(0,s.useFragment)(n(99747),t),d=(0,s.useFragment)(n(47252),r);(0,S.fN)();let[m,b]=(0,i.useState)(!1),p=(0,i.useCallback)(()=>{b(!1)},[b]),g=null===(l=d.subscription)||void 0===l?void 0:l.isActive,f=0===o.messageLimit.dailyLimit&&o.limitedAccessType===k.Z.no_limit&&!d.isEligibleForWebSubscriptions,K=d.useNewLimitSystem?o.messageUsageLimit.shouldPromptSubscription:!g&&!o.messageLimit.canSend&&!f,v=d.useNewLimitSystem?o.messageUsageLimit.shouldShowLimitInfoBanner:o.messageLimit.shouldShowSubscriptionRationale,M=(0,i.useMemo)(()=>({shouldPromptSubscription:K,shouldShowRateLimitedBanner:v,setPaywallVisible:b}),[K,v,b]),D=!!d.poeUser;(0,h.Z)({viewer:d});let T=(0,i.useMemo)(()=>({botId:o.botId}),[o]);return(0,a.jsxs)(L.Provider,{value:D?M:_,children:[u,D&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Suspense,{fallback:null,children:!g&&m&&(0,a.jsx)(F.Z,{body:w,bodyProps:T,onRequestClose:p,bot:o})}),(0,a.jsx)(y,{bot:o,viewer:d}),(0,a.jsx)(c,{bot:o,viewer:d})]})]})}},63236:function(e,l,n){var a=n(67294);let i=a.createContext(null);l.Z=i}}]);